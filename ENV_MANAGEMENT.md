# çŽ¯å¢ƒå˜é‡ç®¡ç†æŒ‡å—

## ðŸ“‹ æ¦‚è¿°

ä¸ºäº†é¿å…çŽ¯å¢ƒå˜é‡åœ¨éƒ¨ç½²æ—¶ä¸¢å¤±æˆ–è¢«è¦†ç›–ï¼Œéƒ¨ç½²è„šæœ¬å·²æ”¹è¿›ä¸º**æ™ºèƒ½åˆå¹¶æ¨¡å¼**ã€‚

## ðŸ”§ å·¥ä½œåŽŸç†

### æ™ºèƒ½åˆå¹¶æœºåˆ¶

1. **å¤‡ä»½çŽ°æœ‰é…ç½®**
   - æ¯æ¬¡éƒ¨ç½²å‰è‡ªåŠ¨å¤‡ä»½ `.env` æ–‡ä»¶
   - å¤‡ä»½æ–‡ä»¶åæ ¼å¼ï¼š`.env.backup.YYYYMMDD_HHMMSS`

2. **ä¿ç•™çŽ°æœ‰å˜é‡**
   - éƒ¨ç½²è„šæœ¬åªæ›´æ–°é¢„å®šä¹‰çš„çŽ¯å¢ƒå˜é‡
   - æ‰‹åŠ¨æ·»åŠ çš„å…¶ä»–å˜é‡ä¼šè¢«ä¿ç•™
   - æ³¨é‡Šå’Œç©ºè¡Œä¹Ÿä¼šä¿ç•™

3. **æ›´æ–°æœºåˆ¶**
   - å¦‚æžœå˜é‡åœ¨è„šæœ¬ä¸­å®šä¹‰ï¼Œä¼šè¢«æ›´æ–°ä¸ºæ–°å€¼
   - å¦‚æžœå˜é‡ä¸åœ¨è„šæœ¬ä¸­ï¼Œä¿æŒåŽŸå€¼ä¸å˜

## ðŸ“ å¦‚ä½•æ·»åŠ æ–°çš„çŽ¯å¢ƒå˜é‡

### æ–¹æ³• 1ï¼šåœ¨æœåŠ¡å™¨ä¸Šç›´æŽ¥ç¼–è¾‘ï¼ˆæŽ¨èç”¨äºŽä¸´æ—¶å˜é‡ï¼‰

```bash
ssh root@173.255.193.131
cd /root/honeyai/server
nano .env
# æ·»åŠ ä½ çš„æ–°å˜é‡
# ä¾‹å¦‚ï¼šMY_CUSTOM_KEY=my_value
```

**ä¼˜ç‚¹**ï¼šç«‹å³ç”Ÿæ•ˆï¼Œä¸ä¼šè¢«éƒ¨ç½²è„šæœ¬è¦†ç›–  
**ç¼ºç‚¹**ï¼šéœ€è¦æ‰‹åŠ¨ç»´æŠ¤ï¼ŒæœåŠ¡å™¨é‡å¯åŽéœ€è¦é‡æ–°è®¾ç½®

### æ–¹æ³• 2ï¼šåœ¨éƒ¨ç½²è„šæœ¬ä¸­æ·»åŠ ï¼ˆæŽ¨èç”¨äºŽæ°¸ä¹…å˜é‡ï¼‰

ç¼–è¾‘ `deploy-full.sh` æ–‡ä»¶ï¼Œåœ¨ `configure_env()` å‡½æ•°çš„ `env_updates` æ•°ç»„ä¸­æ·»åŠ ï¼š

```bash
["MY_CUSTOM_KEY"]="my_value"
```

**ä¼˜ç‚¹**ï¼šç‰ˆæœ¬æŽ§åˆ¶ï¼Œæ¯æ¬¡éƒ¨ç½²è‡ªåŠ¨é…ç½®  
**ç¼ºç‚¹**ï¼šéœ€è¦ä¿®æ”¹ä»£ç å¹¶æäº¤

### æ–¹æ³• 3ï¼šä½¿ç”¨çŽ¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆæŽ¨èç”¨äºŽæ•æ„Ÿä¿¡æ¯ï¼‰

åˆ›å»º `.env.local` æ–‡ä»¶ï¼ˆä¸ä¼šè¢« Git è·Ÿè¸ªï¼‰ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Š
cd /root/honeyai/server
cat >> .env.local << EOF
MY_SECRET_KEY=secret_value
EOF
```

ç„¶åŽåœ¨ä»£ç ä¸­è¯»å–ï¼š

```javascript
// server/index.js
import dotenv from 'dotenv';
dotenv.config(); // åŠ è½½ .env
dotenv.config({ path: '.env.local' } }); // åŠ è½½ .env.local
```

## ðŸ” æ£€æŸ¥çŽ¯å¢ƒå˜é‡

### æŸ¥çœ‹å½“å‰é…ç½®

```bash
ssh root@173.255.193.131
cat /root/honeyai/server/.env
```

### æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶

```bash
ssh root@173.255.193.131
ls -la /root/honeyai/server/.env.backup.*
```

### æ¢å¤å¤‡ä»½

```bash
ssh root@173.255.193.131
cd /root/honeyai/server
cp .env.backup.20250101_120000 .env
pm2 restart all --update-env
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•æ„Ÿä¿¡æ¯**
   - ä¸è¦åœ¨ä»£ç ä»“åº“ä¸­æäº¤åŒ…å«æ•æ„Ÿä¿¡æ¯çš„ `.env` æ–‡ä»¶
   - ä½¿ç”¨ `.env.example` ä½œä¸ºæ¨¡æ¿
   - æ•æ„Ÿä¿¡æ¯åº”è¯¥é€šè¿‡æœåŠ¡å™¨çŽ¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡ç®¡ç†

2. **å˜é‡æ ¼å¼**
   - ç¡®ä¿å˜é‡å€¼ä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ `$`, `"`, `'`ï¼‰
   - å¦‚æžœå¿…é¡»ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ï¼Œä½¿ç”¨å¼•å·åŒ…è£¹

3. **PM2 çŽ¯å¢ƒå˜é‡**
   - ä¿®æ”¹ `.env` åŽï¼Œéœ€è¦é‡å¯ PM2 æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆï¼š
   ```bash
   pm2 restart all --update-env
   ```

4. **éªŒè¯é…ç½®**
   - éƒ¨ç½²åŽæ£€æŸ¥çŽ¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®åŠ è½½ï¼š
   ```bash
   pm2 logs clingai-api | grep "A2E\|R2\|MongoDB"
   ```

## ðŸ› ï¸ æ•…éšœæŽ’æŸ¥

### é—®é¢˜ï¼šçŽ¯å¢ƒå˜é‡ä¸¢å¤±

**åŽŸå› **ï¼šå¯èƒ½æ˜¯éƒ¨ç½²è„šæœ¬è¦†ç›–äº†æ–‡ä»¶

**è§£å†³**ï¼š
1. æ£€æŸ¥å¤‡ä»½æ–‡ä»¶ï¼š`ls -la /root/honeyai/server/.env.backup.*`
2. æ¢å¤å¤‡ä»½ï¼š`cp .env.backup.æœ€æ–°æ—¶é—´ .env`
3. é‡å¯æœåŠ¡ï¼š`pm2 restart all --update-env`

### é—®é¢˜ï¼šå˜é‡æœªç”Ÿæ•ˆ

**åŽŸå› **ï¼šPM2 æ²¡æœ‰é‡æ–°åŠ è½½çŽ¯å¢ƒå˜é‡

**è§£å†³**ï¼š
```bash
pm2 restart all --update-env
# æˆ–
pm2 delete all
pm2 start ecosystem.config.cjs
```

### é—®é¢˜ï¼šå˜é‡å€¼è¢«è¦†ç›–

**åŽŸå› **ï¼šå˜é‡åœ¨éƒ¨ç½²è„šæœ¬ä¸­å®šä¹‰ï¼Œæ¯æ¬¡éƒ¨ç½²éƒ½ä¼šæ›´æ–°

**è§£å†³**ï¼š
1. ä»Žéƒ¨ç½²è„šæœ¬ä¸­ç§»é™¤è¯¥å˜é‡
2. æˆ–ä½¿ç”¨ `.env.local` æ–‡ä»¶ï¼ˆä¸ä¼šè¢«è„šæœ¬å¤„ç†ï¼‰

## ðŸ“š ç›¸å…³æ–‡ä»¶

- `deploy-full.sh` - éƒ¨ç½²è„šæœ¬ï¼ŒåŒ…å«çŽ¯å¢ƒå˜é‡é…ç½®é€»è¾‘
- `server/.env` - æœåŠ¡å™¨ä¸Šçš„çŽ¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆä¸æäº¤åˆ° Gitï¼‰
- `server/.env.example` - çŽ¯å¢ƒå˜é‡æ¨¡æ¿ï¼ˆå¯é€‰ï¼Œå¯æäº¤åˆ° Gitï¼‰

