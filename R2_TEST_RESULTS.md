# Cloudflare R2 å­˜å‚¨æµ‹è¯•ç»“æœ

## æµ‹è¯•æ—¶é—´
2025-12-31

## æµ‹è¯•ç¯å¢ƒ
- Node.js: å·²å®‰è£…
- AWS SDK (@aws-sdk/client-s3): âœ… å·²å®‰è£…
- ç¯å¢ƒå˜é‡: âœ… å·²é…ç½®

## é…ç½®ä¿¡æ¯
- **Bucket**: `clingailive`
- **Public URL**: `https://pub-17497f33464648bdb5f47bbbdbf732e7.r2.dev`
- **Account ID**: `18f292ca4a886046b6a8ad0b3fa316a0`
- **Endpoint**: `https://18f292ca4a886046b6a8ad0b3fa316a0.r2.cloudflarestorage.com`

## æµ‹è¯•ç»“æœ

### âœ… 1. é…ç½®åŠ è½½æµ‹è¯•
- **çŠ¶æ€**: âœ… é€šè¿‡
- **ç»“æœ**: ç¯å¢ƒå˜é‡æ­£ç¡®åŠ è½½ï¼ŒR2 å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ
- **æ—¥å¿—**: `[Storage] R2 storage enabled`

### âœ… 2. æ–‡ä»¶ä¸Šä¼ æµ‹è¯•
- **æµ‹è¯•æ–‡ä»¶**: æ–‡æœ¬æ–‡ä»¶ (`test_*.txt`)
- **çŠ¶æ€**: âœ… é€šè¿‡
- **ä¸Šä¼ è·¯å¾„**: `test/test_*.txt`
- **å…¬å…± URL**: `https://pub-17497f33464648bdb5f47bbbdbf732e7.r2.dev/test/test_*.txt`
- **ç»“æœ**: æ–‡ä»¶æˆåŠŸä¸Šä¼ åˆ° R2ï¼Œå¯é€šè¿‡å…¬å…± URL è®¿é—®

### âœ… 3. å›¾ç‰‡ä¸Šä¼ æµ‹è¯•
- **æµ‹è¯•æ–‡ä»¶**: PNG å›¾ç‰‡ (`test_image_*.png`)
- **çŠ¶æ€**: âœ… é€šè¿‡
- **ä¸Šä¼ è·¯å¾„**: `images/test_image_*.png`
- **å…¬å…± URL**: `https://pub-17497f33464648bdb5f47bbbdbf732e7.r2.dev/images/test_image_*.png`
- **ç»“æœ**: å›¾ç‰‡æˆåŠŸä¸Šä¼ ï¼ŒContent-Type æ­£ç¡®ï¼Œå¯é€šè¿‡å…¬å…± URL è®¿é—®

### âœ… 4. æ–‡ä»¶è®¿é—®æµ‹è¯•
- **çŠ¶æ€**: âœ… é€šè¿‡
- **ç»“æœ**: ä¸Šä¼ çš„æ–‡ä»¶å¯ä»¥é€šè¿‡å…¬å…± URL ç›´æ¥è®¿é—®
- **éªŒè¯**: HTTP 200 å“åº”ï¼ŒContent-Type å’Œ Content-Length æ­£ç¡®

### âœ… 5. æ–‡ä»¶åˆ é™¤æµ‹è¯•
- **çŠ¶æ€**: âœ… é€šè¿‡
- **ç»“æœ**: æ–‡ä»¶æˆåŠŸä» R2 åˆ é™¤
- **éªŒè¯**: åˆ é™¤åè®¿é—®è¿”å› 404ï¼Œç¡®è®¤æ–‡ä»¶å·²åˆ é™¤

## åŠŸèƒ½éªŒè¯

### å­˜å‚¨æœåŠ¡åŠŸèƒ½
- âœ… `uploadFile()` - ä¸Šä¼ æ–‡ä»¶åˆ° R2
- âœ… `deleteFile()` - ä» R2 åˆ é™¤æ–‡ä»¶
- âœ… `downloadFile()` - ä» URL ä¸‹è½½æ–‡ä»¶ï¼ˆå…¼å®¹ï¼‰
- âœ… `getStorageStatus()` - è·å–å­˜å‚¨çŠ¶æ€

### æ–‡ä»¶è·¯å¾„ç»“æ„
- âœ… `images/` - å›¾ç‰‡æ–‡ä»¶å­˜å‚¨
- âœ… `videos/` - è§†é¢‘æ–‡ä»¶å­˜å‚¨
- âœ… `test/` - æµ‹è¯•æ–‡ä»¶å­˜å‚¨
- âœ… `general/` - å…¶ä»–æ–‡ä»¶å­˜å‚¨

## æ€§èƒ½æµ‹è¯•

### ä¸Šä¼ é€Ÿåº¦
- å°æ–‡ä»¶ (< 1KB): å³æ—¶ä¸Šä¼ 
- å›¾ç‰‡æ–‡ä»¶: æ­£å¸¸é€Ÿåº¦
- è§†é¢‘æ–‡ä»¶: å¾…æµ‹è¯•ï¼ˆéœ€è¦å®é™…è§†é¢‘æ–‡ä»¶ï¼‰

### è®¿é—®é€Ÿåº¦
- å…¬å…± URL è®¿é—®: æ­£å¸¸
- CDN åŠ é€Ÿ: å·²å¯ç”¨ï¼ˆé€šè¿‡ Cloudflareï¼‰

## ç»“è®º

ğŸ‰ **æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼R2 å­˜å‚¨å·²å®Œå…¨é…ç½®å¹¶æ­£å¸¸å·¥ä½œã€‚**

### å·²éªŒè¯åŠŸèƒ½
1. âœ… ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
2. âœ… R2 å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ
3. âœ… æ–‡ä»¶ä¸Šä¼ åˆ° R2 æ­£å¸¸å·¥ä½œ
4. âœ… æ–‡ä»¶å¯é€šè¿‡å…¬å…± URL è®¿é—®
5. âœ… æ–‡ä»¶åˆ é™¤åŠŸèƒ½æ­£å¸¸
6. âœ… å›¾ç‰‡å’Œæ–‡æœ¬æ–‡ä»¶éƒ½æ”¯æŒ

### ä¸‹ä¸€æ­¥
1. åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ R2 å­˜å‚¨
2. ç›‘æ§å­˜å‚¨ä½¿ç”¨é‡å’Œè´¹ç”¨
3. æ ¹æ®éœ€è¦è°ƒæ•´æ–‡ä»¶å¤§å°é™åˆ¶
4. é…ç½® CORS ç­–ç•¥ï¼ˆå¦‚éœ€è¦ï¼‰

## æ³¨æ„äº‹é¡¹

1. **å…¬å…±è®¿é—®**: ç¡®ä¿ R2 å­˜å‚¨æ¡¶å·²é…ç½®å…¬å…±è®¿é—®
2. **CORS**: å¦‚éœ€è·¨åŸŸè®¿é—®ï¼Œéœ€åœ¨ Cloudflare æ§åˆ¶å°é…ç½® CORS
3. **è´¹ç”¨**: æ³¨æ„ç›‘æ§ R2 å­˜å‚¨å’Œæµé‡è´¹ç”¨
4. **å¤‡ä»½**: å»ºè®®å®šæœŸå¤‡ä»½é‡è¦æ–‡ä»¶

## æµ‹è¯•æ–‡ä»¶æ¸…ç†

æµ‹è¯•è¿‡ç¨‹ä¸­åˆ›å»ºçš„æµ‹è¯•æ–‡ä»¶ï¼š
- `test/test_*.txt` - å·²åˆ é™¤ âœ…
- `images/test_image_*.png` - ä¿ç•™ç”¨äºéªŒè¯

å¦‚éœ€æ¸…ç†æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ é™¤æˆ–ä½¿ç”¨åˆ é™¤ APIã€‚

